<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:VK.Mobile.ViewModels"
             xmlns:loc="clr-namespace:VK.Mobile.Services"
             x:Class="VK.Mobile.Views.MainMapPage"
             x:DataType="vm:MainMapViewModel"
             Title="VK Street Food">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Top Bar -->
        <Grid Grid.Row="0"
              Padding="10"
              BackgroundColor="#FF5722">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0"
                   Text="{Binding Source={x:Static loc:LocalizationResourceManager.Instance}, Path=[MapTitle]}"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="White"
                   VerticalOptions="Center"/>

            <Picker Grid.Column="1"
                    Title="{Binding Source={x:Static loc:LocalizationResourceManager.Instance}, Path=[Language]}"
                    SelectedIndex="{Binding SelectedLanguageIndex}"
                    TextColor="White"
                    TitleColor="White"
                    WidthRequest="130"
                    Margin="10,0"
                    SelectedIndexChanged="OnLanguageChanged">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Tiáº¿ng Viá»‡t</x:String>
                        <x:String>English</x:String>
                        <x:String>í•œêµ­ì–´</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Button Grid.Column="2"
                    Text="ðŸ“·"
                    FontSize="24"
                    BackgroundColor="Transparent"
                    WidthRequest="44"
                    HeightRequest="44"
                    Clicked="OnQRScanClicked"/>
        </Grid>

        <!-- Map Container -->
        <ContentView x:Name="MapContainer"
                     Grid.Row="1"/>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="1"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           Color="#FF5722"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"/>

        <!-- Bottom Info Bar -->
        <Grid Grid.Row="2"
              Padding="10"
              BackgroundColor="White">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Label Grid.Column="0"
                   Text="ðŸ“"
                   FontSize="24"
                   VerticalOptions="Center"/>

            <StackLayout Grid.Column="1"
                         Spacing="2"
                         Margin="10,0">
                <Label FontSize="14"
                       FontAttributes="Bold">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Source={x:Static loc:LocalizationResourceManager.Instance}, Path=[POIsLabel]}"/>
                            <Span Text=": "/>
                            <Span Text="{Binding Pois.Count}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
                <Label FontSize="12"
                        TextColor="Gray">
                    <Label.FormattedText>
                        <FormattedString>
                            <Span Text="{Binding Source={x:Static loc:LocalizationResourceManager.Instance}, Path=[NearbyLabel]}"/>
                            <Span Text=": "/>
                            <Span Text="{Binding NearbyPOIs.Count}"/>
                        </FormattedString>
                    </Label.FormattedText>
                </Label>
            </StackLayout>

            <Frame Grid.Column="2"
                   Padding="8,4"
                   BackgroundColor="{Binding IsTracking, Converter={StaticResource BoolToColorConverter}}"
                   CornerRadius="12"
                   HasShadow="False">
                <Label Text="{Binding IsTracking, Converter={StaticResource BoolToTrackingTextConverter}}"
                       TextColor="White"
                       FontSize="12"/>
            </Frame>
        </Grid>

    </Grid>

</ContentPage>
